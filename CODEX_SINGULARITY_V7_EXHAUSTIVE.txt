
================================================================================
          CHESHIRE MEMORY SYSTEM - THE DEFINITIVE GENOME V7 (SINGULARITY)
================================================================================
Codinome: "THE QUANTUM GRIN"
Vers√£o: 7.0.0-GOLD
Arquiteto: Principal Cognitive Systems Architect
Status: PROTOCOLO DE CONSTRU√á√ÉO ABSOLUTA (SEM RESUMOS)
================================================================================

1. A ONTOLOGIA BIOGR√ÅFICA (O MAPEAMENTO DA ALMA)
--------------------------------------------------------------------------------
O Cheshire n√£o divide a vida em "√çntimo" e "Profissional". Ele mapeia a exist√™ncia em 7 Esferas de Resson√¢ncia. Cada fato at√¥mico (SPO) deve ser carimbado com um ou mais desses escopos:

1.1. CORE_IDENTITY (A √Çncora): 
Fatos imut√°veis ou fundamentais do Ser. Nome, data de nascimento, traumas estruturantes, valores morais irrevog√°veis. 
- Gravidade Padr√£o: 1.0. 
- Eros√£o: Nula.

1.2. KINSHIP_LINEAGE (Fam√≠lia): 
Rela√ß√µes de sangue e obriga√ß√µes ancestrais. Hierarquias familiares, segredos de linhagem, anivers√°rios de parentes, tens√µes entre membros.
- Gravidade Padr√£o: 0.9.
- Link Prediction: Prioridade em resson√¢ncia de datas.

1.3. AFFINITY_CIRCLE (Amigos e Tribos): 
Rela√ß√µes por escolha. Graus de lealdade (Jack Schafer Scale), piadas internas, hist√≥rico de favores, n√≠veis de confian√ßa (Trust Score 0-100).
- Gravidade Padr√£o: 0.7.

1.4. PROFESSIONAL_NET (Carreira): 
Habilidades, projetos, hierarquia corporativa, metas financeiras, colegas, reputa√ß√£o de mercado.
- Gravidade Padr√£o: 0.8.

1.5. VITAL_STATE (Sa√∫de e Bem-estar): 
Alergias (Cr√≠tico), hist√≥rico m√©dico, padr√£o de sono, sa√∫de mental, v√≠cios, dieta atual.
- Gravidade Padr√£o: 0.95 (Safety First).

1.6. AMBITION_DRIVE (Desejos e Futuro): 
Planos de viagem, sonhos de consumo, inten√ß√µes de aprendizado, "O que eu quero ser quando crescer".
- Gravidade Padr√£o: 0.5 (Alta plasticidade).

1.7. EXTERNAL_CONTEXT (O Mundo): 
Intera√ß√µes com sistemas de terceiros (Delivery, Uber, Calend√°rio, E-mail). Logs frios que alimentam as outras esferas.

2. O T√ÅLAMO: PROTOCOLO DE INGEST√ÉO MATRICIAL (INGESTION LAYER)
--------------------------------------------------------------------------------
O processamento de entrada deve ocorrer em <150ms. O n8n (Executivo) envia matrizes para economizar tokens.

2.1. Descompress√£o Sem√¢ntica:
O Cheshire recebe o `media_schema`, `location_schema` e `contacts_schema`. Ele deve reconstruir a "Cena" antes da extra√ß√£o.
- Exemplo: Se `media_schema` cont√©m ["img", "desc", "cap"], o Cheshire gera internamente: "O usu√°rio enviou uma IMAGEM descrita como [desc] com a legenda [cap]".

2.2. O Content-Hashing (Deduplica√ß√£o de N√≠vel 0):
- Algoritmo: SHA-256 do payload normalizado.
- Cache: Redis L1 (TTL 24h).
- A√ß√£o: Se o hash bater, o Cheshire retorna `status: 304 (Not Modified)` e apenas atualiza o `last_seen` do evento original no Postgres, sem disparar Embeddings.

2.3. O Filtro de Baixa Entropia:
- Regra: Mensagens com menos de 3 bits de informa√ß√£o sem√¢ntica (Ex: "ok", "beleza", "üëç") s√£o marcadas como `is_fatic: true`.
- Destino: Tabela `raw_events` apenas. Elas nunca tocam o Qdrant nem geram triadas SPO.

3. O ESPELHO LATENTE: DUAL-MAPPING E SVD (VECTOR LAYER)
--------------------------------------------------------------------------------
A intui√ß√£o (128D) e a ess√™ncia (2048D) vivem em Named Vectors no Qdrant.

3.1. O Vulto (Named Vector: "shadow_128"):
- Proje√ß√£o: Redu√ß√£o via PCA (Principal Component Analysis).
- Treinamento: A matriz de proje√ß√£o √© recalculada via SVD (Singular Value Decomposition) a cada 1000 fatos por Project_ID. 
- Localiza√ß√£o: A matriz reside no `metadata` do projeto (VPS 2) mas √© carregada em RAM (VPS 3) no boot.

3.2. A Ess√™ncia (Named Vector: "core_2048"):
- Modelo: text-embedding-3-large.
- Fun√ß√£o: Compara√ß√£o profunda de nuances.

3.3. Semantic Healing (O Worker de Reparo):
- Gatilho: Se uma busca no "shadow_128" retorna um ID com similaridade > 0.95 mas o campo `is_cold` √© true.
- A√ß√£o: Re-vetoriza√ß√£o On-The-Fly do texto original para o "core_2048" e update no Qdrant.

4. CARTOGRAFIA DE TRIADAS: SPO + PLUTCHIK 512 (KNOWLEDGE LAYER)
--------------------------------------------------------------------------------
A unidade m√≠nima de consci√™ncia √© o [Sujeito] -> [Predicado] -> [Objeto].

4.1. O Ontological Guardrail (Dicion√°rio de Predicados):
O sistema mant√©m uma tabela de normaliza√ß√£o de verbos/predicados.
- Entrada: "receia", "tem pavor", "tem medo".
- Sa√≠da Can√¥nica: "tem_medo_de".
- Objetivo: Evitar a fragmenta√ß√£o do grafo por sinon√≠mia de LLM.

4.2. O Espectro de Plutchik 512D:
Cada triada SPO √© mapeada em um vetor emocional de 512 dimens√µes.
- Base: Alegria, Tristeza, Raiva, Medo, Nojo, Surpresa, Antecipa√ß√£o, Confian√ßa.
- Expans√£o: Deriva√ß√µes din√¢micas (Ex: "Nostalgia T√≥xica", "Empolga√ß√£o Profissional").
- Uso: O Or√°culo recupera fatos n√£o apenas por tema, mas por compatibilidade emocional com a query atual.

5. GNN ENGINE: O SONHADOR (REASONING LAYER)
--------------------------------------------------------------------------------
O Cheshire sonha a cada 300 segundos para tecer conex√µes.

5.1. Link Prediction (Intui√ß√£o Sint√©tica):
- Se N√≥ A (Gosta de Velejar) e N√≥ B (Mora em Florian√≥polis) coexistem.
- A GNN cria uma aresta inferida: `source: 'Dreamer'`, `weight: 0.65`, `type: 'locality_affinity'`.

5.2. Hub Protection (Poda Espectral):
- Limite: M√°ximo de 50 arestas de sa√≠da por n√≥ no carregamento em RAM.
- Crit√©rio: `Confidence * Interaction_Count`.
- Motivo: Impede que n√≥s gen√©ricos travem o c√°lculo de vizinhan√ßa.

6. O JUIZ DE DISSON√ÇNCIA: LEI DA RECORR√äNCIA E SCARRING
--------------------------------------------------------------------------------
Como lidar quando o usu√°rio mente ou muda de ideia?

6.1. Scarring (A Cicatriz):
- Se Fato B contradiz Fato A no mesmo escopo.
- Fato A N√ÉO √© deletado. Ele recebe a flag `is_scar: true` e sua `confidence` cai para 0.1.
- Valor: O sistema entende a evolu√ß√£o da persona ("Ele era vegetariano, agora come carne").

6.2. Protocolo Hidden Signal (_cascata_guardian):
- Se Disson√¢ncia > 50%.
- A√ß√£o: A API injeta no JSON de resposta para o Executivo:
  `"_cascata_guardian": { "alert": "DIFFERING_TRUTHS", "fact_a": "...", "fact_b": "...", "resolve_via": "ask_user" }`

7. TERMODIN√ÇMICA DO SISTEMA (EXECUTION & RESILIENCE)
--------------------------------------------------------------------------------
7.1. Outbox Pattern Sem√¢ntico (Garantia de Sincronia):
1. Salva no Postgres (VPS 2) -> `sync_status: 'pending'`.
2. Worker background tenta salvar no Qdrant (VPS 2).
3. Sucesso -> Update Postgres para `sync_status: 'synced'`.
4. Falha -> Retry com backoff at√© 24h.

7.2. Nostalgia Governor (CPU Protection):
Se o sistema detectar mais de 5 re-materializa√ß√µes (Semantic Healing) por minuto para o mesmo usu√°rio:
- A√ß√£o: Trava a re-vetoriza√ß√£o, usa o contexto bruto do Postgres e agenda o "Healing Profundo" para o per√≠odo de sono da madrugada.

7.3. AI Gateway Redundancy:
Pool de 5 slots de API.
- Slot 1-2: Ultra-Performance (Ex: Groq/Llama-3).
- Slot 3-4: Deep Reasoning (Ex: Gemini-1.5-Pro).
- Slot 5: Local Failback (Ex: Llama-3-8B 4-bit na VPS 3).

8. SOBERANIA E IMORTALIDADE (.CAF 2.0)
--------------------------------------------------------------------------------
8.1. Estrutura do Snapshot Soberano:
O arquivo .CAF gerado pelo Cascata deve conter:
- `/graph`: Dump SQL das tabelas de Triadas e Emo√ß√µes.
- `/vectors`: Snapshot bin√°rio das cole√ß√µes do Qdrant.
- `/matrices`: Matrizes SVD/PCA de 128D por projeto.
- `/biography`: Um resumo narrativo gerado por IA no momento do backup.

8.2. Anonimiza√ß√£o Irrevers√≠vel (Right to be Forgotten):
- Em caso de dele√ß√£o, o UUID do usu√°rio √© transformado em um hash SHA-512 salteado. 
- O Grafo permanece intacto, mas o dono √© agora uma "Sombra Estat√≠stica". O sistema mant√©m o aprendizado, mas perde o rastro biogr√°fico.

================================================================================
          FIM DO CODEX FINAL - CHESHIRE MEMORY SYSTEM SINGULARITY
              "O gato √© opcional. O sorriso √© inegoci√°vel."
================================================================================
